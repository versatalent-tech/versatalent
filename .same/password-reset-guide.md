# Password Reset System

## Overview

The password reset system allows administrators to reset user passwords for talents and other users. This is essential when users forget their passwords or need their credentials changed.

## Features

### 1. Admin Password Reset
- Reset any user's password from the admin panel
- Two options:
  - **Generate Random Password**: Auto-generate a secure 12-character password
  - **Set Custom Password**: Manually enter a new password (min 8 characters)
- Copy new password to clipboard
- Instant password update

### 2. Security
- Passwords hashed with bcrypt before storage
- Minimum 8 character requirement
- Generated passwords include uppercase, lowercase, numbers, and symbols
- Admin-only functionality (requires admin authentication)

## Admin Usage

### Resetting a Talent's Password

1. **Navigate to Talent Management**
   - Go to `/admin/talents`
   - Find the talent whose password you want to reset

2. **Open Password Reset Dialog**
   - Click the üîë (key) icon on the talent's card
   - The system will load the user's information

3. **Choose Reset Method**

   **Option A: Generate Random Password**
   - Click "Generate Secure Password"
   - System creates a 12-character random password
   - Password is displayed in yellow box
   - Click copy button to copy to clipboard
   - Save the password and share with user

   **Option B: Set Custom Password**
   - Enter a custom password (min 8 characters)
   - Click eye icon to show/hide password
   - Click "Set" button to apply
   - Confirm with the user

4. **Share New Credentials**
   - Copy the new password
   - Share securely with the talent (encrypted channel)
   - Instruct talent to change password after first login

## API Endpoints

### Reset User Password

```
POST /api/users/[id]/reset-password
Content-Type: application/json

Request Body (Generate Random):
{
  "generateRandom": true
}

Request Body (Custom Password):
{
  "newPassword": "mynewpassword123",
  "generateRandom": false
}

Response (200 OK):
{
  "success": true,
  "message": "Password reset successfully",
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "name": "User Name"
  },
  "newPassword": "K9m#2Np$7qH5" // Only if generateRandom: true
}

Error Response (404):
{
  "error": "User not found"
}

Error Response (400):
{
  "error": "Password must be at least 8 characters long"
}
```

### Get Users by Talent ID

```
GET /api/users?talentId=<talent-uuid>

Response (200 OK):
[
  {
    "id": "user-uuid",
    "name": "User Name",
    "email": "user@example.com",
    "role": "artist",
    "talent_id": "talent-uuid",
    "created_at": "2025-12-03T...",
    "updated_at": "2025-12-03T..."
  }
]

Note: password_hash is excluded from response for security
```

## User Experience

### When Admin Resets Password

1. Admin clicks key icon on talent card
2. System fetches user associated with talent
3. Dialog opens with two reset options
4. Admin chooses method and confirms
5. Password is updated immediately in database
6. Admin receives new password (if random generation)
7. Admin shares password with talent securely

### When Talent Receives New Password

1. Talent receives new password from admin
2. Talent navigates to `/dashboard`
3. Talent logs in with email and new password
4. Talent should change password after login (future feature)

## Components

### PasswordResetDialog Component

**Location**: `src/components/admin/PasswordResetDialog.tsx`

**Props**:
```typescript
interface PasswordResetDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  userId: string;
  userName: string;
  userEmail: string;
  onSuccess?: () => void;
}
```

**Features**:
- Random password generation
- Custom password input
- Show/hide password toggle
- Copy to clipboard
- Loading states
- Error handling
- Success feedback

### CredentialsDialog Component

**Location**: `src/components/admin/CredentialsDialog.tsx`

**Props**:
```typescript
interface CredentialsDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  credentials: {
    name: string;
    email: string;
    password: string;
  };
}
```

**Features**:
- Display user credentials after creation
- Copy individual fields (name, email, password)
- Copy all credentials formatted
- Warning about password visibility
- Dashboard link information

## Password Security

### Generated Passwords

Passwords generated by the system:
- **Length**: 12 characters
- **Uppercase**: A-Z (excluding I, O)
- **Lowercase**: a-z (excluding i, l, o)
- **Numbers**: 2-9 (excluding 0, 1)
- **Symbols**: !@#$%&*+-=?
- **Randomized**: Characters shuffled randomly
- **No confusing chars**: Avoids easily misread characters

Example: `K9m#2Np$7qH5`

### Password Storage

- All passwords hashed with bcrypt (10 rounds)
- Salt automatically generated
- Original password never stored
- Cannot be retrieved from database
- Must reset to change

### Password Validation

Custom passwords must meet:
- Minimum 8 characters
- No maximum length (reasonable limit in DB)
- No special requirements (admin discretion)

## Error Handling

### Common Errors

**"User not found"**
- User account doesn't exist
- User ID is invalid
- Solution: Verify user exists

**"No user account found for this talent"**
- Talent exists but no linked user
- User may not have been created during talent creation
- Solution: Create user manually or recreate talent

**"Could not find user account for this talent"**
- API request failed
- Network error
- Solution: Check network, retry

**"Password must be at least 8 characters long"**
- Custom password too short
- Solution: Use longer password

## Troubleshooting

### Password Reset Not Working

**Problem**: Password reset button doesn't work

**Solution**:
1. Check browser console for errors
2. Verify user account exists for talent
3. Check admin authentication is valid
4. Verify API endpoint is accessible

### User Can't Login After Reset

**Problem**: Talent says new password doesn't work

**Solutions**:
1. Verify password was copied correctly
2. Check for extra spaces or characters
3. Ensure password wasn't truncated
4. Try generating a new password
5. Check user is using correct email

### Copy Button Not Working

**Problem**: Can't copy password to clipboard

**Solutions**:
1. Check browser clipboard permissions
2. Manually select and copy text
3. Use keyboard shortcuts (Ctrl+C)
4. Try different browser

## Security Best Practices

### For Admins

‚úÖ **DO**:
- Generate random passwords when possible
- Share passwords via secure channels (encrypted email, Signal, in-person)
- Instruct users to change passwords after first login
- Keep a secure record of password resets
- Reset passwords immediately if compromised

‚ùå **DON'T**:
- Share passwords via insecure channels (plain email, SMS, Slack)
- Reuse the same password for multiple users
- Leave password visible on screen in public
- Write passwords in plain text files
- Share passwords with unauthorized people

### For Users

‚úÖ **DO**:
- Change password after first login
- Use unique password for VersaTalent
- Store password in password manager
- Report lost/forgotten passwords immediately

‚ùå **DON'T**:
- Share password with anyone
- Reuse password from other sites
- Write password on sticky notes
- Leave account logged in on shared computers

## Future Enhancements

### Planned Features

- [ ] **Email-based password reset** - Users can reset their own passwords
- [ ] **Password reset tokens** - Time-limited reset links
- [ ] **Force password change** - Require password change on next login
- [ ] **Password history** - Prevent reusing recent passwords
- [ ] **Password strength meter** - Visual feedback on password strength
- [ ] **Two-factor authentication** - Additional security layer
- [ ] **Password expiry** - Require periodic password changes
- [ ] **Audit log** - Track all password resets

### Email-Based Reset (Future)

When email integration is added:

1. User clicks "Forgot Password" on login page
2. User enters email address
3. System sends password reset email
4. Email contains time-limited reset link
5. User clicks link and sets new password
6. Link expires after 1 hour or first use

This requires:
- Email service integration (SendGrid, Mailgun, etc.)
- Password reset token generation
- Token expiration logic
- Password reset page for users
- Email templates

## Testing

### Manual Testing Checklist

- [ ] Test generating random password
- [ ] Test setting custom password
- [ ] Test minimum password length validation
- [ ] Test copy to clipboard
- [ ] Test show/hide password
- [ ] Test error handling
- [ ] Test success feedback
- [ ] Test user can login with new password
- [ ] Test password reset for multiple users
- [ ] Test closing dialog without saving

### Edge Cases

- [ ] Reset password for user without talent_id
- [ ] Reset password multiple times quickly
- [ ] Very long custom passwords
- [ ] Special characters in custom passwords
- [ ] Unicode characters in passwords
- [ ] Password reset while user is logged in

## Related Documentation

- [Talent User Accounts Guide](./talent-user-accounts-guide.md)
- [Admin Authentication Guide](../ADMIN_AUTH_GUIDE.md)
- [Admin Talents Guide](./talent-management-guide.md)
- [User Repository](../src/lib/db/repositories/users.ts)

---

**Last Updated**: December 3, 2025
**Version**: 154
**Status**: ‚úÖ Complete and Ready to Use
